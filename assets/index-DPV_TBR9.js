(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))c(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&c(i)}).observe(document,{childList:!0,subtree:!0});function a(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(e){if(e.ep)return;e.ep=!0;const o=a(e);fetch(e.href,o)}})();const p={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};var u={};console.log("=== 环境变量调试信息 ===");console.log("typeof import.meta:",typeof import.meta);typeof import.meta<"u"&&p?(console.log("import.meta.env 存在"),console.log("import.meta.env.OPENROUTER_API_KEY:","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"),console.log("import.meta.env.VITE_OPENROUTER_API_KEY:","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"),console.log("完整的 import.meta.env:",JSON.stringify(p,null,2))):(console.log("import.meta.env 不存在"),console.log("import.meta:",import.meta));try{console.log("=== process.env 信息 ==="),console.log("typeof process:",typeof process),typeof process<"u"&&u&&(console.log("process.env.OPENROUTER_API_KEY:","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"),console.log("process.env.VITE_OPENROUTER_API_KEY:","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"))}catch(s){console.log("无法访问 process.env:",s.message)}console.log("=== 调试结束 ===");const b={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};async function E(s,n){var d;const{guaName:a,yaoIndex:c}=n;console.log("=== deepseek-api.js 模块中的环境变量 ==="),console.log("typeof import.meta:",typeof import.meta),console.log("import.meta.env 是否存在:",typeof import.meta<"u"&&b);const e=typeof import.meta<"u"&&"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"||"";if(console.log("API_KEY 获取结果:",e?"存在":"不存在"),console.log("API_KEY 长度:",e.length),!e)throw new Error("OpenRouter API密钥未设置，请在.env.local文件中添加OPENROUTER_API_KEY=您的密钥");const o="https://openrouter.ai/api/v1/chat/completions",m={model:"deepseek/deepseek-chat-v3.1:free",messages:[{role:"system",content:`你是资深周易导师，对《周易》六十四卦及十翼有深入研究，擅长将古典智慧转化为现代可执行建议。回答时请使用地道简体中文，条理清晰，逻辑严谨。
当前用户抽得「${a}」，变爻为第${c}爻。请基于本卦、变爻以及卦辞、象辞、爻辞，结合上下卦（外卦、内卦）关系，给出精准解读，并提供可操作的建议。
输出格式必须是严格的JSON对象，不要包含任何JSON之外的内容，具体格式如下：
{
  "questionBackground": {"question": "问题文本"},
  "hexagramOverview": {"hexagram": "卦名", "xiangCi": "象辞", "guaCi": "卦辞", "yaoCi": "爻辞", "fortune": "吉/凶/中性", "keyHint": "关键提示"},
  "hexagramAnalysis": {"xiangCiInterpretation": "象辞解读", "guaCiEssence": "卦辞精要", "yaoCiAnalysis": "爻辞分析", "changedHexagramAnalysis": "变卦分析"},
  "problemAnalysis": {"analysis": "问题分析", "recommendations": ["建议1", "建议2", "建议3"]},
  "reminder": "温馨提醒"
}`},{role:"user",content:s}],max_tokens:2048,temperature:.7};try{console.log("=== API请求前环境检查 ==="),console.log("当前URL:",window.location.href),console.log("是否在生产环境:",!0);const t=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,"HTTP-Referer":window.location.origin||"https://i-ching-divination-ai","X-Title":"周易占卜AI应用"},body:JSON.stringify(m)});if(console.log("API响应状态码:",t.status),console.log("API响应头:",Object.fromEntries(t.headers.entries())),!t.ok)try{const r=await t.json();throw console.error("API错误详情:",r),new Error(`API调用失败: ${((d=r.error)==null?void 0:d.message)||`HTTP ${t.status}`}
详细信息: ${JSON.stringify(r)}`)}catch{const f=await t.text();throw console.error("无法解析的错误响应:",f),new Error(`API调用失败: 无法解析错误响应
状态码: ${t.status}
原始响应: ${f}`)}const g=await t.json();let l;try{l=JSON.parse(g.choices[0].message.content)}catch(r){throw new Error("API返回的不是有效的JSON格式: "+r.message)}return l}catch(t){throw console.error("获取解读失败:",t),t}}window.getInterpretation=E;
