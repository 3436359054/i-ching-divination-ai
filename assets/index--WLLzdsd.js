(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&i(t)}).observe(document,{childList:!0,subtree:!0});function g(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=g(o);fetch(o.href,n)}})();const y={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};var E={};console.log("=== 环境变量调试信息 ===");console.log("typeof import.meta:",typeof import.meta);typeof import.meta<"u"&&y?(console.log("import.meta.env 存在"),console.log("import.meta.env.OPENROUTER_API_KEY:","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"),console.log("import.meta.env.VITE_OPENROUTER_API_KEY:","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"),console.log("完整的 import.meta.env:",JSON.stringify(y,null,2))):(console.log("import.meta.env 不存在"),console.log("import.meta:",import.meta));try{console.log("=== process.env 信息 ==="),console.log("typeof process:",typeof process),typeof process<"u"&&E&&(console.log("process.env.OPENROUTER_API_KEY:","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"),console.log("process.env.VITE_OPENROUTER_API_KEY:","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"))}catch(a){console.log("无法访问 process.env:",a.message)}console.log("=== 调试结束 ===");const _={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};async function O(a,e){var m,d;const{guaName:g,yaoIndex:i}=e;console.log("=== deepseek-api.js 模块中的环境变量 ==="),console.log("typeof import.meta:",typeof import.meta),console.log("import.meta.env 是否存在:",typeof import.meta<"u"&&_);const o=typeof import.meta<"u"&&"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"||"",n=window.location.href.includes("github.io");console.log("=== 环境检测 ==="),console.log("是否在GitHub Pages环境:",n);const t=o.trim();if(console.log("=== API密钥详细信息 ==="),console.log("API_KEY 获取结果:",t?"存在":"不存在"),console.log("API_KEY 长度:",t.length),console.log("API_KEY 前10个字符:",t.substring(0,Math.min(10,t.length))+"..."),console.log("API_KEY 后10个字符:",t.length>10?"..."+t.substring(t.length-10):t),console.log("是否包含Bearer前缀:",t.startsWith("Bearer ")),console.log("是否包含空格:",t.includes(" ")),!t)throw new Error("OpenRouter API密钥未设置，请在.env.local文件中添加OPENROUTER_API_KEY=您的密钥");t.length<30&&console.warn("警告: API密钥长度较短，可能不正确");const u="https://openrouter.ai/api/v1/chat/completions",l={model:"deepseek/deepseek-chat-v3.1:free",messages:[{role:"system",content:`你是资深周易导师，对《周易》六十四卦及十翼有深入研究，擅长将古典智慧转化为现代可执行建议。回答时请使用地道简体中文，条理清晰，逻辑严谨。
当前用户抽得「${g}」，变爻为第${i}爻。请基于本卦、变爻以及卦辞、象辞、爻辞，结合上下卦（外卦、内卦）关系，给出精准解读，并提供可操作的建议。
输出格式必须是严格的JSON对象，不要包含任何JSON之外的内容，具体格式如下：
{
  "questionBackground": {"question": "问题文本"},
  "hexagramOverview": {"hexagram": "卦名", "xiangCi": "象辞", "guaCi": "卦辞", "yaoCi": "爻辞", "fortune": "吉/凶/中性", "keyHint": "关键提示"},
  "hexagramAnalysis": {"xiangCiInterpretation": "象辞解读", "guaCiEssence": "卦辞精要", "yaoCiAnalysis": "爻辞分析", "changedHexagramAnalysis": "变卦分析"},
  "problemAnalysis": {"analysis": "问题分析", "recommendations": ["建议1", "建议2", "建议3"]},
  "reminder": "温馨提醒"
}`},{role:"user",content:a}],max_tokens:2048,temperature:.7};console.log("请求体结构:",JSON.stringify(l,null,2)),console.log("请求体大小:",new Blob([JSON.stringify(l)]).size,"bytes"),console.log("是否包含system消息:",l.messages.some(c=>c.role==="system"));try{console.log("=== API请求前环境检查 ==="),console.log("当前URL:",window.location.href),console.log("是否在生产环境:",!0),console.log("=== 请求参数详情 ==="),console.log("请求URL:",u),console.log("请求模型:",l.model),console.log("Authorization头格式:",`Bearer ${o.substring(0,5)}...`);let c;t.startsWith("Bearer ")?(c=t,console.log("注意: API_KEY已经包含Bearer前缀，直接使用")):(c=`Bearer ${t}`,console.log("添加Bearer前缀到API密钥")),console.log("最终使用的Authorization头:",c.substring(0,Math.min(15,c.length))+"...");const p={method:"POST",headers:{"Content-Type":"application/json",Authorization:c,"HTTP-Referer":n?window.location.origin:window.location.href,"X-Title":"I-Ching Divination AI",Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36"},body:JSON.stringify(l),credentials:"omit",referrerPolicy:n?"unsafe-url":"no-referrer-when-downgrade",mode:"cors",cache:"no-cache"};console.log("fetch选项:",JSON.stringify(p,(h,f)=>h==="body"?"...省略的请求体...":f,2));const r=await fetch(u,p);if(console.log("API响应状态码:",r.status),console.log("API响应头:",Object.fromEntries(r.headers.entries())),!r.ok){const h=r.clone();try{const f=await r.json();if(console.error("API错误详情:",f),r.status===401){let s=`API调用失败: ${((m=f.error)==null?void 0:m.message)||`HTTP ${r.status}`}`;throw s+=`

重要提示：401 "User not found" 错误通常表示您的API密钥无效！`,s+=`

解决步骤：`,s+=`
1. 检查API密钥格式是否正确（应以 sk-or-v1- 开头）`,s+=`
2. 确认API密钥没有多余的空格或特殊字符`,s+=`
3. 登录OpenRouter官网验证密钥有效性（https://openrouter.ai/）`,s+=`
4. 如果密钥无效，请生成新的API密钥`,s+=`
5. 清除浏览器缓存后重新启动应用`,n&&(s+=`

GitHub Pages环境说明：`,s+=`
- 由于浏览器安全限制，直接在GitHub Pages中使用API密钥可能会受到限制`,s+=`
- 建议先在本地环境测试API连接是否正常`,s+=`
- 长期解决方案：使用后端服务器代理API请求`),new Error(s)}else throw new Error(`API调用失败: ${((d=f.error)==null?void 0:d.message)||`HTTP ${r.status}`}
详细信息: ${JSON.stringify(f)}`)}catch{const s=await h.text();throw console.error("无法解析的错误响应:",s),new Error(`API调用失败: 无法解析错误响应
状态码: ${r.status}
原始响应: ${s}`)}}const A=await r.json();let I;try{I=JSON.parse(A.choices[0].message.content)}catch(h){throw new Error("API返回的不是有效的JSON格式: "+h.message)}return I}catch(c){throw console.error("获取解读失败:",c),c}}window.getInterpretation=O;const v={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};console.log("=== OpenRouter API详细调试 ===");function R(){return new Date().toLocaleTimeString()}function b(a){console.log(`
==== ${a} ==== (${R()})`)}(async function(){try{b("环境变量检查"),console.log("typeof import.meta:",typeof import.meta),console.log("import.meta.env是否存在:",typeof import.meta<"u"&&v);const e=(typeof import.meta<"u"&&"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"||"").trim();console.log("API密钥长度:",e.length),console.log("API密钥前10个字符:",e.substring(0,Math.min(10,e.length))+"..."),console.log("API密钥后10个字符:",e.length>10?"..."+e.substring(e.length-10):e),console.log("API密钥是否包含Bearer前缀:",e.startsWith("Bearer ")),console.log("API密钥是否包含空格:",e.includes(" ")),console.log("API密钥是否全为大写/小写:",e===e.toUpperCase()||e===e.toLowerCase()),b("API端点检查"),console.log("API URL:","https://openrouter.ai/api/v1/chat/completions");const i=[{name:"标准Bearer认证",getAuthHeader:()=>e.startsWith("Bearer ")?e:`Bearer ${e}`},{name:"无Bearer前缀认证",getAuthHeader:()=>e.startsWith("Bearer ")?e.substring(7):e}];for(const o of i)try{await w(o.name,o.getAuthHeader())}catch(n){console.error(`${o.name}测试失败:`,n)}b("调试总结"),console.log("请检查以下几点:"),console.log("1. OpenRouter API密钥是否有效（到OpenRouter官网验证）"),console.log("2. API密钥格式是否正确（不应包含额外的空格或字符）"),console.log("3. 是否使用了正确的API端点"),console.log("4. 网络连接是否正常，是否有防火墙或代理问题"),console.log("5. 尝试创建一个新的OpenRouter API密钥")}catch(a){console.error("调试过程中发生全局错误:",a)}})();async function w(a,e){var o,n,t,u,P,l;b(`测试认证方式: ${a}`);const g="https://openrouter.ai/api/v1/chat/completions",i={model:"deepseek/deepseek-chat-v3.1:free",messages:[{role:"user",content:"Hello, simple test message!"}],max_tokens:50,temperature:.7};console.log("请求模型:",i.model),console.log("Authorization头格式:",e.substring(0,Math.min(15,e.length))+"...");try{const m=Date.now(),d=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",Authorization:e,"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36"},body:JSON.stringify(i),credentials:"omit",mode:"cors",cache:"no-cache"}),c=Date.now();console.log(`请求耗时: ${c-m}ms`),console.log("响应状态码:",d.status);const p=Object.fromEntries(d.headers.entries());console.log("响应头中的内容类型:",p["content-type"]),console.log("响应头中的请求ID:",p["x-request-id"]||"不存在"),console.log("响应头中的速率限制:",p["x-ratelimit-limit"]||"不存在");try{const r=await d.json();console.log("响应数据结构:",Object.keys(r)),d.ok?(console.log("✅ 认证成功！API调用返回了有效响应"),console.log("响应内容摘要:",((u=(t=(n=(o=r.choices)==null?void 0:o[0])==null?void 0:n.message)==null?void 0:t.content)==null?void 0:u.substring(0,50))+"...")):(console.error("❌ 认证失败:",((P=r.error)==null?void 0:P.message)||"未知错误"),console.error("错误代码:",(l=r.error)==null?void 0:l.code),console.error("完整错误信息:",r))}catch(r){const A=await d.text();console.error("无法解析响应JSON:",r),console.error("原始响应文本:",A)}}catch(m){console.error("网络请求错误:",m)}}
