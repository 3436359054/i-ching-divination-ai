(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))f(o);new MutationObserver(o=>{for(const t of o)if(t.type==="childList")for(const e of t.addedNodes)e.tagName==="LINK"&&e.rel==="modulepreload"&&f(e)}).observe(document,{childList:!0,subtree:!0});function g(o){const t={};return o.integrity&&(t.integrity=o.integrity),o.referrerPolicy&&(t.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?t.credentials="include":o.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function f(o){if(o.ep)return;o.ep=!0;const t=g(o);fetch(o.href,t)}})();const h={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};var y={};console.log("=== 环境变量调试信息 ===");console.log("typeof import.meta:",typeof import.meta);typeof import.meta<"u"&&h?(console.log("import.meta.env 存在"),console.log("import.meta.env.OPENROUTER_API_KEY:","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"),console.log("import.meta.env.VITE_OPENROUTER_API_KEY:","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"),console.log("完整的 import.meta.env:",JSON.stringify(h,null,2))):(console.log("import.meta.env 不存在"),console.log("import.meta:",import.meta));try{console.log("=== process.env 信息 ==="),console.log("typeof process:",typeof process),typeof process<"u"&&y&&(console.log("process.env.OPENROUTER_API_KEY:","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"),console.log("process.env.VITE_OPENROUTER_API_KEY:","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"))}catch(d){console.log("无法访问 process.env:",d.message)}console.log("=== 调试结束 ===");const _={BASE_URL:"/i-ching-divination-ai/",DEV:!1,MODE:"production",OPENROUTER_API_KEY:"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",PROD:!0,SSR:!1,VITE_OPENROUTER_API_KEY:"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"};async function A(d,i){var p,u;const{guaName:g,yaoIndex:f}=i;console.log("=== deepseek-api.js 模块中的环境变量 ==="),console.log("typeof import.meta:",typeof import.meta),console.log("import.meta.env 是否存在:",typeof import.meta<"u"&&_);const o=typeof import.meta<"u"&&"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"||"",t=window.location.href.includes("github.io");console.log("=== 环境检测 ==="),console.log("是否在GitHub Pages环境:",t);const e=o.trim();if(console.log("=== API密钥详细信息 ==="),console.log("API_KEY 获取结果:",e?"存在":"不存在"),console.log("API_KEY 长度:",e.length),console.log("API_KEY 前10个字符:",e.substring(0,Math.min(10,e.length))+"..."),console.log("API_KEY 后10个字符:",e.length>10?"..."+e.substring(e.length-10):e),console.log("是否包含Bearer前缀:",e.startsWith("Bearer ")),console.log("是否包含空格:",e.includes(" ")),!e)throw new Error("OpenRouter API密钥未设置，请在.env.local文件中添加OPENROUTER_API_KEY=您的密钥");e.length<30&&console.warn("警告: API密钥长度较短，可能不正确");const m="https://openrouter.ai/api/v1/chat/completions",a={model:"deepseek/deepseek-chat-v3.1:free",messages:[{role:"system",content:`你是资深周易导师，对《周易》六十四卦及十翼有深入研究，擅长将古典智慧转化为现代可执行建议。回答时请使用地道简体中文，条理清晰，逻辑严谨。
当前用户抽得「${g}」，变爻为第${f}爻。请基于本卦、变爻以及卦辞、象辞、爻辞，结合上下卦（外卦、内卦）关系，给出精准解读，并提供可操作的建议。
输出格式必须是严格的JSON对象，不要包含任何JSON之外的内容，具体格式如下：
{
  "questionBackground": {"question": "问题文本"},
  "hexagramOverview": {"hexagram": "卦名", "xiangCi": "象辞", "guaCi": "卦辞", "yaoCi": "爻辞", "fortune": "吉/凶/中性", "keyHint": "关键提示"},
  "hexagramAnalysis": {"xiangCiInterpretation": "象辞解读", "guaCiEssence": "卦辞精要", "yaoCiAnalysis": "爻辞分析", "changedHexagramAnalysis": "变卦分析"},
  "problemAnalysis": {"analysis": "问题分析", "recommendations": ["建议1", "建议2", "建议3"]},
  "reminder": "温馨提醒"
}`},{role:"user",content:d}],max_tokens:2048,temperature:.7};console.log("请求体结构:",JSON.stringify(a,null,2)),console.log("请求体大小:",new Blob([JSON.stringify(a)]).size,"bytes"),console.log("是否包含system消息:",a.messages.some(r=>r.role==="system"));try{console.log("=== API请求前环境检查 ==="),console.log("当前URL:",window.location.href),console.log("是否在生产环境:",!0),console.log("=== 请求参数详情 ==="),console.log("请求URL:",m),console.log("请求模型:",a.model),console.log("Authorization头格式:",`Bearer ${o.substring(0,5)}...`);let r;e.startsWith("Bearer ")?(r=e,console.log("注意: API_KEY已经包含Bearer前缀，直接使用")):(r=`Bearer ${e}`,console.log("添加Bearer前缀到API密钥")),console.log("最终使用的Authorization头:",r.substring(0,Math.min(15,r.length))+"...");const b={method:"POST",headers:{"Content-Type":"application/json",Authorization:r,"HTTP-Referer":t?window.location.origin:window.location.href,"X-Title":"I-Ching Divination AI",Accept:"application/json","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36"},body:JSON.stringify(a),credentials:"omit",referrerPolicy:t?"unsafe-url":"no-referrer-when-downgrade",mode:"cors",cache:"no-cache"};console.log("fetch选项:",JSON.stringify(b,(l,c)=>l==="body"?"...省略的请求体...":c,2));const s=await fetch(m,b);if(console.log("API响应状态码:",s.status),console.log("API响应头:",Object.fromEntries(s.headers.entries())),!s.ok){const l=s.clone();try{const c=await s.json();if(console.error("API错误详情:",c),s.status===401){let n=`API调用失败: ${((p=c.error)==null?void 0:p.message)||`HTTP ${s.status}`}`;throw n+=`

可能的解决方法：`,n+=`
1. 检查API密钥是否正确（注意不要有空格）`,n+=`
2. 确认API密钥在OpenRouter平台上是否有效`,n+=`
3. 确保.env文件中的密钥格式正确`,n+=`
4. 清除浏览器缓存后重试`,t&&(n+=`

GitHub Pages环境特殊说明：`,n+=`
- GitHub Pages是纯静态托管服务，API认证可能受限制`,n+=`
- 尝试在本地开发环境测试API是否正常工作`,n+=`
- 考虑使用API代理服务解决认证问题`),new Error(n)}else throw new Error(`API调用失败: ${((u=c.error)==null?void 0:u.message)||`HTTP ${s.status}`}
详细信息: ${JSON.stringify(c)}`)}catch{const n=await l.text();throw console.error("无法解析的错误响应:",n),new Error(`API调用失败: 无法解析错误响应
状态码: ${s.status}
原始响应: ${n}`)}}const E=await s.json();let P;try{P=JSON.parse(E.choices[0].message.content)}catch(l){throw new Error("API返回的不是有效的JSON格式: "+l.message)}return P}catch(r){throw console.error("获取解读失败:",r),r}}window.getInterpretation=A;
